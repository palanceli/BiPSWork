# ç¬¬16ç«  ä½¿ç”¨åœ°å›¾

æœ¬ç« å°†è¯¦æƒ…é¡µçš„å•å…ƒæ ¼åŸå‹ç”±2æ”¹ä¸º3ï¼Œåœ¨ç¬¬ä¸‰æ ¼ä¸­æ’å…¥åœ°å›¾ï¼Œç‚¹å‡»åè½¬åœºåˆ°åœ°å›¾è¯¦æƒ…é¡µï¼Œå¦‚ä¸‹å›¾ï¼š
![](images/1600.jpg)
- åœ°å›¾ä½¿ç”¨äº†MapKitView
- å±•ç¤ºäº†å¦‚ä½•å°†åœ°å€ä¸²é€šè¿‡äº‘æœåŠ¡è½¬æˆåæ ‡
- è‡ªå®šä¹‰äº†åœ°å›¾æ ‡è¯†

## æ·»åŠ åœ°å›¾
1. é€‰æ‹©project - target - ç‚¹å‡»+ Capacity - æœç´¢MapsåŒå‡»æ·»åŠ ï¼š

![](images/1601.png)

2. æ‰“å¼€Main.storyboardï¼Œå°†detail view controllerçš„table viewçš„å•å…ƒæ ¼ç”±2æ”¹ä¸º3ï¼Œé€‰ä¸­å¤åˆ¶å‡ºæ¥çš„ç¬¬3ä¸ªå•å…ƒæ ¼ï¼Œåˆ é™¤åŒ…è£¹å®ƒçš„stack view

![](images/1602.png)

3. æ·»åŠ ä¸€ä¸ªMap Kit Viewåˆ°æ–°çš„å•å…ƒæ ¼é‡Œï¼Œè®¾ç½®çº¦æŸï¼šå››è¾¹è·å‡ä¸º0ï¼Œé«˜åº¦200ï¼Œä¸è¦å‹¾é€‰Constrain to marginsã€‚æµ‹è¯•Map Kit Viewè¶…å‡ºäº†è®¾å¤‡çš„é«˜åº¦ï¼Œå¯ä»¥åœ¨Document outlineä¸­é€‰ä¸­Restaurant Detail View Controllerï¼Œåœ¨size inspector ä¸­å°†simulated sizeç”±Fixedä¿®æ”¹ä¸ºFreeformï¼Œå¹¶è®¾å€¼é«˜åº¦ä¸º1000ï¼Œæ¨¡æ‹Ÿå™¨å°±ä¼šè¢«æŠ»é«˜åˆ°1000ï¼Œä»¥æ–¹ä¾¿ç¼–è¾‘ã€‚æ¥çœ‹Map Kit Viewçš„å±æ€§ï¼Œä¸è¦å‹¾é€‰Scrollingã€Rotatingã€å’Œ3D Viewï¼Œåœ¨æœ¬ç« å°½é‡ä¿æŒè¯¥è§†å›¾ç®€å•ã€‚
4. ä¸ºåœ°å›¾åˆ›æ‰€åœ¨å•å…ƒæ ¼å»ºå¯¹åº”çš„ç±»ï¼ŒNew File... - Cocoa Touch Class - å‘½åä¸ºRestaurantDetailMapCellï¼ŒåŸºç±»ä¸ºUITableViewCellï¼Œä»£ç å¦‚ä¸‹ï¼š
``` swift
import UIKit
import MapKit   // å¼•å…¥MapKitï¼Œä»¥æ”¯æŒMKMapView

class RestaurantDetailMapCell: UITableViewCell {
    @IBOutlet var mapView: MKMapView!   // å®šä¹‰åœ°å›¾view

    override func awakeFromNib() {
        super.awakeFromNib()
        // Initialization code
    }

    override func setSelected(_ selected: Bool, animated: Bool) {
        super.setSelected(selected, animated: animated)
        // Configure the view for the selected state
    }
}
```
5. åœ¨Main.storyboardä¸­å°†æ–°å»ºå•å…ƒæ ¼çš„identifierå’Œç±»åå‡è®¾ç½®ä¸ºRestaurantDetailMapCellï¼Œå¹¶å°†mapViewå’Œå¯¹åº”çš„è§†å›¾å…ƒç´ å»ºç«‹å…³è”ï¼š

![](images/1603.png)
6. ä¿®æ”¹RestaurantDetailViewController.swiftå¦‚ä¸‹ï¼š
``` swift
extension RestaurantDetailViewController: UITableViewDataSource, UITableViewDelegate {
    
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return 3   // è¿”å›ä¸‰ä¸ªå•å…ƒæ ¼
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        switch indexPath.row {
        case 0:
            // â€¦â€¦
            
        case 1:
            // â€¦â€¦
        case 2:    // å®šä¹‰ç¬¬3ä¸ªå•å…ƒæ ¼
            let cell = tableView.dequeueReusableCell(withIdentifier: String(describing: RestaurantDetailMapCell.self), for: indexPath) as! RestaurantDetailMapCell
            return cell
        default:
            fatalError("Failed to instantiate the table view cell for detail view controller")
        }
    }
}
```
## æ˜¾ç¤ºå…¨å±åœ°å›¾
1. æ‹–å…¥ä¸€ä¸ªæ–°çš„view controllerï¼Œå†åœ¨è¿™ä¸ªVCé‡Œæ‹–å…¥ä¸€ä¸ªMap Kit Viewï¼Œå¹¶å°†å››ä¸ªè¾¹è·è®¾ç½®ä¸º0
2. æ‘ä½Ctrlå°†é¼ æ ‡ä»RestaurantDetailMapCellæ‹–åˆ°æ–°çš„VCï¼Œå¹¶åœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©Showï¼Œåœ¨ä¸¤ä¸ªUIé—´åˆ›å»ºä¸€ä¸ªè½¬åœºï¼ˆæ³¨æ„ä¸€å®šæ˜¯ä»RestaurantDetailMapCellï¼Œè€Œä¸æ˜¯MapKitViewï¼Œå¦åˆ™ä¸ä¼šå¼¹å‡ºèœå•ï¼‰ï¼Œå¹¶å°†è¯¥è½¬åœºçš„identifierå‘½åä¸ºShowMap

## å°†åœ°å€è½¬æ¢æˆåœ°å›¾åæ ‡
frameworkæä¾›äº†Geocoderç±»å°†æ–‡æœ¬åœ°å€è½¬æ¢æˆåœ°å›¾åæ ‡ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºæ­£å‘geocodingï¼›åè¿‡æ¥ä¹Ÿå¯ä»¥ï¼Œè¢«ç§°ä¸ºé€†å‘geocodingã€‚ä»£ç å¦‚ä¸‹ï¼š
``` swift
let geoCoder = CLGeocoder()
geoCoder.geocodeAddressString("524 Ct St, Brooklyn, NY 11231", 
                              completionHandler: { placemarks, error in
// å¤„ç†placemarkçš„ä»£ç 
})
```
> å¯¹äºè¢«è½¬æ¢çš„åœ°å€ä¸²æ²¡æœ‰å›ºå®šè¦æ±‚ï¼Œè¯¥å‡½æ•°ä¼šå°†ä½ç½®å­—ä¸²å¼‚æ­¥æäº¤æœåŠ¡ç«¯ï¼Œç”±æœåŠ¡ç«¯è§£æå¹¶è¿”å›ä¸€ä¸ªplacemarkå¯¹è±¡æ•°ç»„ã€‚æ•°ç»„çš„ä¸ªæ•°ä¾èµ–è¾“å…¥çš„åœ°å€ä¿¡æ¯ï¼Œåœ°å€è¶Šè¯¦ç»†ï¼Œå°±ä¼šå¾—åˆ°è¶Šç²¾å‡†çš„è¿”å›æ•°æ®ã€‚å¦‚æœæäº¤çš„åœ°å€æ¯”è¾ƒæ¨¡ç³Šï¼Œå°±ä¼šè¿”å›å¤šä¸ªå¯èƒ½çš„placemarkå¯¹è±¡ã€‚
## åœ°å›¾æ ‡è¯†
> iOS11ä¹‹å‰ï¼Œåœ°å›¾æ ‡è¯†åªèƒ½æ˜¾ç¤ºä¸ºå¤§å¤´é’ˆï¼Œåæ¥çš„ç‰ˆæœ¬åœ¨MapKit frameworkä¸­ï¼Œè‹¹æœé‡æ–°è®¾è®¡äº†åœ°å›¾æ ‡è¯†æ ·å¼ï¼Œé»˜è®¤æ ·å¼æ›´æ´‹æ°”ä¸€äº›ã€‚æ–°çš„æ ‡è¯†æ ·å¼åŒ…å«ä¸¤ä¸ªå¯¹è±¡ï¼š
â— æ ‡è¯†å¯¹è±¡ï¼šç”¨äºä¿å­˜æ ‡è¯†æ•°æ®ï¼Œæ¯”å¦‚ä½ç½®çš„åç§°ï¼Œè¯¥å¯¹è±¡å¿…é¡»éµå®ˆMKAnnotationåè®®ã€‚
â— æ ‡è¯†è§†å›¾ï¼šç”¨æ¥æ˜¾ç¤ºæ ‡è¯†ï¼Œæ¯”å¦‚å¯ä»¥æ˜¾ç¤ºä¸ºå¤§å¤´é’ˆï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ä»»ä½•å›¾å½¢ã€‚
## åœ¨åœ°å›¾ä¸Šæ·»åŠ ä¸€ä¸ªæ ‡è¯†
åœ¨RestaurantDetailMapCell.swiftä¸­æ·»åŠ configureå‡½æ•°ï¼Œå°†åœ°å€è½¬æ¢æˆåæ ‡å¹¶æ·»åŠ ä¸ºåœ°å›¾æ ‡è¯†ï¼š
``` swift
func configure(location: String) {
    // Get location
    let geoCoder = CLGeocoder()
    print(location)
    geoCoder.geocodeAddressString(location, completionHandler: { placemarks, error in
        if let error = error {
            print(error.localizedDescription)
            return
        }
        if let placemarks = placemarks {
            // è·å–è§£æåˆ°çš„ç¬¬ä¸€ä¸ªåœ°å€
            let placemark = placemarks[0]
            // æ·»åŠ åœ°å›¾æ ‡è¯†
            let annotation = MKPointAnnotation()
            if let location = placemark.location {
                // Display the annotation
                annotation.coordinate = location.coordinate
                self.mapView.addAnnotation(annotation)
                // Set the zoom level
                let region = MKCoordinateRegion(center: annotation.coordinate, latitudinalMeters: 250, longitudinalMeters: 250)
                self.mapView.setRegion(region, animated: false)
            }
        }
    })
}
```
æ›´æ–°RestaurantDetailViewController.swiftä¸­çš„tableView(_:cellForRowAt:_)çš„case2éƒ¨åˆ†ï¼Œè®©ä¼ å…¥çš„åœ°å€ä¸²åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼š
``` swift
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    switch indexPath.row {
    // â€¦â€¦
    case 2:
        let cell = tableView.dequeueReusableCell(withIdentifier: String(describing: RestaurantDetailMapCell.self), for: indexPath) as! RestaurantDetailMapCell
        cell.configure(location: restaurant.location) // è®©åœ°å€ç”Ÿæ•ˆ
        cell.selectionStyle = .none
        return cell
    // â€¦â€¦
    }
}
```
## åœ¨å…¨å±åœ°å›¾ä¸Šæ˜¾ç¤ºæ ‡è¯†
1. æ–°å»ºæ–‡ä»¶ï¼šNew File... - Cocoa Touch Class - å‘½åä¸ºMapViewControllerï¼ŒåŸºç±»æ˜¯UIViewControllerï¼Œæ·»åŠ åœ°å›¾å’ŒRestaurantå˜é‡å¦‚ä¸‹ï¼š
``` swift
import UIKit
import MapKit

class MapViewController: UIViewController {
    @IBOutlet var mapView : MKMapView!
    var restaurant = Restaurant()
    
    override func viewDidLoad() {
        super.viewDidLoad()

        // å’Œä¸Šä¸€èŠ‚ç±»ä¼¼ï¼šå°†åœ°å€ä¸²è½¬æˆåæ ‡å¹¶åœ¨åœ°å›¾ä¸Šæ ‡è¯†å‡ºæ¥
        let geoCoder = CLGeocoder()
        geoCoder.geocodeAddressString(
            restaurant.location,
            completionHandler:{ placemarks, error in
                if let error = error {
                    print(error)
                    return
                }
                if let placemarks = placemarks {
                    let placemark = placemarks[0]
                    let annotation = MKPointAnnotation()
                    // æ˜¾ç¤ºæ ‡é¢˜å’Œå‰¯æ ‡é¢˜
                    annotation.title = self.restaurant.name
                    annotation.subtitle = self.restaurant.type
                    
                    if let location = placemark.location {
                        annotation.coordinate = location.coordinate
                        // æ˜¾ç¤ºå¤§å¤´é’ˆ
                        self.mapView.showAnnotations([annotation], animated: true)
                        self.mapView.selectAnnotation(annotation, animated: true)
                    }
                }
            }
        )
    }
}
```
2. æ¥åˆ°Main.storyboardä¸‹ï¼Œç»™MapViewControllerä¿®æ”¹å¯¹åº”çš„ç±»ï¼Œå¹¶å…³è”æ§ä»¶åˆ°å˜é‡ï¼š

![](images/1604.png)
> åœ°å›¾æ ‡è¯†æœ‰ä¸‰ç§çŠ¶æ€ï¼š
â— é»˜è®¤æ˜¯æœªé€‰ä¸­çŠ¶æ€ï¼Œæ ‡è¯†ä¸ªå¤´ä¼šç•¥å°
â— ä¸Šé¢ä»£ç ä¸­å°†çŠ¶æ€è®¾ç½®ä¸ºé€‰ä¸­ï¼Œä¸ªå¤´ä¼šé•¿å¤§
â— ç¬¬ä¸‰ç§çŠ¶æ€ï¼Œä¹¦é‡Œæ²¡è®²
3. æœ€åRestaurantDetailViewController.swiftä¸­æ·»åŠ prepare(for:sender:)å°†restaurantä¼ è¿›å»ï¼š
``` swift
override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
    if segue.identifier == "ShowMap"{
        let destinationController = segue.destination as! MapViewController
        destinationController.restaurant = restaurant
    }
}
```

## è‡ªå®šä¹‰åœ°å›¾æ ‡è¯†
å®˜æ–¹æ–‡æ¡£ä¸­æœ‰å…·ä½“è‡ªå®šä¹‰åœ°å›¾æ ‡è¯†çš„æ–¹æ³•ï¼šhttps://developer.apple.com/documentation/mapkit/mkmarkerannotationview	
â— markerTintColor - è‡ªå®šä¹‰æ°”çƒèƒŒæ™¯
â— glyphText - è‡ªå®šä¹‰æ°”çƒæ–‡æœ¬
â— plyphImage - è‡ªå®šä¹‰æ°”çƒçš„å›¾æ ‡
 å¦‚æœè¦è‡ªå®šä¹‰åœ°å›¾æ ‡è¯†çš„æ ·å¼ï¼Œéœ€è¦è®©MapViewControlleréµå®ˆMKMapViewDelegateåè®®ï¼Œå¹¶å®ç°mapView(_ mapView: annotation:)æ–¹æ³•ï¼š
``` swift
 class MapViewController: UIViewController {
    @IBOutlet var mapView : MKMapView!
    var restaurant = Restaurant()

    override func viewDidLoad() {
        super.viewDidLoad()
        mapView.delegate = self // å°†ä»£ç†è®¾ä¸ºè‡ªå·±
        // â€¦â€¦
    }
}

extension MapViewController: MKMapViewDelegate {
    func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -> MKAnnotationView? {
        let identifier = "MyMarker"
        if annotation.isKind(of: MKUserLocation.self) {
            return nil
        }
        // Reuse the annotation if possible
        var annotationView: MKMarkerAnnotationView? = mapView.dequeueReusableAnnotationView(withIdentifier: identifier) as? MKMarkerAnnotationView
        if annotationView == nil {
            annotationView = MKMarkerAnnotationView(annotation: annotation, reuseIdentifier: identifier)
        }
        annotationView?.glyphText = "ğŸ˜"
        annotationView?.markerTintColor = UIColor.orange
        return annotationView
    }
}
```

# ç¬¬17ç«  åŠ¨ç”»ã€è§†è§‰æ•ˆæœå’ŒUnwind Segue
æœ¬ç« åœ¨è¯¦æƒ…é¡µçš„åº•éƒ¨æ·»åŠ è¯„ä»·æŒ‰é’®ï¼Œç‚¹å‡»åå¼¹å‡ºè¯„ä»·çª—å£ï¼š
![](images/1700.jpg)
- **æœ¬ç« ä»‹ç»äº†å‡ ç§å¼¹å‡ºçª—å£çš„æ–¹å¼**
- **é€€å‡ºSegueçš„æ–¹å¼** åœ¨çˆ¶çª—å£ä¸­å®šä¹‰IBActioné€€å‡ºå‡½æ•°ï¼Œåœ¨é€€å‡ºçª—å£ä¸­è®¾ç½®è§¦å‘æŒ‰é’®
- **é€€å‡ºSegueæ—¶å›ä¼ æ•°æ®** åœ¨çˆ¶çª—å£çš„é€€å‡ºå‡½æ•°æ ¹æ®Segue.identifierè·å–é€€å‡ºæº
- **ç»™è¯„ä»·æŒ‰é’®è®¾ç½®å‡ ç§åŠ¨ç”»æ•ˆæœ** ï¼šæ¸ç°ã€ä»ä¸€ä¾§é£å…¥ç­‰ï¼ŒæŒæ¡ä»¿å°„å˜æ¢çš„åº”ç”¨

## æ·»åŠ è¯„ä»·æŒ‰é’®
1. æŠŠè¯„ä»·æŒ‰é’®å›¾æ ‡ï¼ˆhttp://www.appcoda.com/resources/swift4/FoodPinRatingButtons.zipï¼‰ å¯¼å…¥å·¥ç¨‹çš„Assetsã€‚
2. æ‰“å¼€Main.storyboardï¼Œé€‰ä¸­RestaurantDetailViewControllerï¼Œä¸ºäº†åç»­æ“ä½œæ–¹ä¾¿ï¼Œå°†Size inspector/Simulated Size/Heightè®¾ç½®ä¸º1200ã€‚åœ¨RestaurantDetailViewControlleråº•éƒ¨æ‹–å…¥ä¸€ä¸ªViewï¼Œå¹¶è®¾å€¼é«˜åº¦ä¸º90ã€‚åœ¨è¯¥Viewä¸­æ‹–å…¥ä¸€ä¸ªButtonï¼Œè®¾ç½®å››å‘¨è¾¹è·å‡ä¸º20ï¼Œä¸è¦å‹¾é€‰Contrain to marginsï¼Œè®¾ç½®æ–‡å­—ä¸ºRate itï¼Œå­—ä½“ï¼šHeadline - Text Styleï¼Œé¢œè‰²ï¼šwhiteï¼ŒèƒŒæ™¯è‰²ï¼šNavigationBarTitle colorã€‚è®¾ç½®æŒ‰é’®åœ†è§’ï¼šIdentify inspector - ç‚¹å‡»+ - åœ¨User Defined Runtime Attributesä¸­æ·»åŠ key Path=cornerRadiusï¼ŒType=Numberï¼ŒValue=25ã€‚

![](images/1701.png)
## åˆ›å»ºRestaurant Review VC
1. æ‹–å…¥ä¸€ä¸ªViewControllerï¼Œå¹¶åœ¨å…¶ä¸­æ‹–å…¥ä¸€ä¸ªImage Viewï¼Œè®¾ç½®content modeä¸ºAspect fillï¼Œå››å‘¨è¾¹è·ä¸º0ã€‚
2. åœ¨å³ä¸Šè§’æ‹–å…¥ä¸€ä¸ªButtonï¼Œè®¾ç½®æ–‡å­—ä¸ºç©ºï¼Œå›¾æ ‡ä¸ºxmarkï¼Œä¿®æ”¹Default Symbol Configuration/Configurationä¸ºPoint Sizeï¼ŒPoint Sizeä¸º30ï¼ŒTint Colorä¸ºWhiteï¼Œå¹¶è®¾å€¼å³ã€ä¸Šè¾¹è·åˆ†åˆ«ä¸º20ã€0ã€‚

![](images/1702.png)
3. çºµå‘æ‹–å…¥5ä¸ªButtonï¼Œè®¾ç½®å­—ä½“ä¸ºLarge Titleï¼ŒTitleå’ŒImageåˆ†åˆ«ä¸ºï¼šAwesome/loveã€Good/Coolã€Okay/Happyã€Bad/Sadã€Terrible/Angryï¼Œç„¶åæŠŠå®ƒä»¬è£…åˆ°ä¸€ä¸ªStack Viewé‡Œï¼Œè®¾ç½®è¯¥Stack View çš„Alignmentä¸ºLeadingï¼Œspacingä¸º10ã€‚æœ€åè®¾ç½®è¯¥Stack Viewåœ¨çˆ¶çª—å£ä¸­çš„å¯¹é½æ–¹å¼ä¸ºæ°´å¹³ã€ç«–ç›´å‡å±…ä¸­å¯¹é½ï¼š

![](images/1703.png)
4. æ–°å»ºæ–‡ä»¶ï¼Œæ¨¡æ¿ä¸ºCocoa Touch Classï¼Œç±»åï¼šReviewViewControllerï¼ŒåŸºç±»ï¼šUIViewControllerï¼Œæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š
``` swift
class ReviewViewController: UIViewController {
    // èƒŒæ™¯å›¾ å’Œ ä¼ å…¥çš„restaurant å˜é‡
    @IBOutlet var backgroundImageView: UIImageView!
    var restaurant = Restaurant()

    override func viewDidLoad() {
        super.viewDidLoad()

        // å°†ä¼ å…¥çš„restaurantçš„å›¾ç‰‡è®¾ç½®ä¸ºèƒŒæ™¯å›¾
        backgroundImageView.image = UIImage(named: restaurant.image)
    }
}
```
å›åˆ°Main.storyboardï¼Œå°†å‰æ–‡æ·»åŠ çš„VCçš„ç±»åè®¾ç½®ä¸ºReviewViewControllerï¼Œå³é”®ï¼Œå°†backgroundImageViewå…³è”åˆ°ImageViewæ§ä»¶ä¸Šã€‚
## åˆ›å»ºè½¬åœº
1. æŒ‰ä½Ctrlï¼Œä»Rate itæŒ‰é’®æ‹–åˆ°æ–°çš„VCï¼Œå¹¶é€‰æ‹©è½¬åœºç±»å‹ä¸ºPresent modallyï¼Œidentifierå‘½åä¸ºshowReview
2. æ›´æ–°RestaurantDetailViewControllerï¼š
``` swift
override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
    switch segue.identifier {
    case "showMap":         // è½¬åœºåˆ°åœ°å›¾VC
        let destinationController = segue.destination as! MapViewController
        destinationController.restaurant = restaurant
    case "showReview":      // è½¬åœºåˆ°è¯„ä»·VC
        let destinationContrller = segue.destination as! ReviewViewController
        destinationContrller.restaurant = restaurant
    default:
        break
    }
}
```
> ä»iOS13ä»¥åï¼Œæ¨¡æ€çª—çš„å‡ºåœºå½¢å¼å°±ä¸å†æ˜¯é»˜è®¤å…¨å±æ˜¾ç¤ºäº†ï¼Œè€Œæ˜¯åœ¨åŸæœ‰çª—ä½“ä¸Šé¢ç›–ä½ä¸€ä¸ªéå…¨å±çš„ç±»ä¼¼å¡ç‰‡çš„çª—ä½“ï¼Œå¹¶ä¸”é»˜è®¤æ”¯æŒé€šè¿‡ä»ä¸Šåˆ°ä¸‹ä¸‰æŒ‡æ‰«çš„æ‰‹åŠ¿å°†çª—ä½“å…³é—­ã€‚
åœ¨è®¾ç½®è½¬åœºç±»å‹çš„æ—¶å€™ï¼Œå¦‚æœè®¾ç½®æˆFull Screenï¼Œå°±å¯ä»¥é€€å›åˆ°æ—§ç‰ˆçš„å…¨å±æ¨¡æ€çª—ä½“éªŒã€‚

> iOSæä¾›äº†å‡ ç§è½¬åœºçš„è¿‡æ¸¡å½¢å¼ï¼Œé€‰ä¸­Sugueååœ¨Attribute inspector/Transitionä¸­å¯ä»¥è®¾ç½®ã€‚é»˜è®¤æ˜¯Cover Verticalï¼ˆè‡ªåº•è€Œä¸Šå¼¹å‡ºï¼‰ï¼Œå…¶å®ƒå¯é€‰çš„è¿˜æœ‰Cross Dissolveï¼ˆæ¸å˜ï¼‰ï¼ŒFlip Horizontalï¼ˆæ°´å¹³ç¿»è½¬ï¼‰

## é€€å‡ºè¯„ä»·VC
å¦‚æœé€‰æ‹©äº†Full Screenç±»å‹çš„è½¬åœºæ¨¡æ€çª—ï¼Œä¼šä»¤é»˜è®¤çš„ä¸‹åˆ’é€€å‡ºæ‰‹åŠ¿å¤±æ•ˆï¼Œéœ€è¦è‡ªå·±å†™é€€å‡ºä»£ç ã€‚
1. åœ¨RestaurantDetailViewControllerä¸­åŠ å…¥é€€å‡ºä»£ç ï¼š
``` swift
@IBAction func close(segue: UIStoryboardSegue){
    dismiss(animated: true, completion: nil)
}
```
2. å›åˆ°Main.storyboardï¼Œæ‘ä½Ctrlå°†å³ä¸Šè§’çš„å…³é—­æŒ‰é’®æ‹–åˆ°é€€å‡ºå›¾æ ‡ï¼Œåœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©closeWithSegueï¼š

![](images/1704.png)
<font color=red>æˆ‘çš„é—®é¢˜ï¼šè§¦å‘é€€å‡ºæ˜¯åœ¨è¯„ä»·çª—ï¼Œä¸ºå•¥é€€å‡ºä»£ç æ˜¯å†™åœ¨çˆ¶çª—ä½“ï¼Ÿç•Œé¢ä¸Šçš„æ‹–æ‹½èƒŒåä»£ç æ˜¯æ€ä¹ˆå†™çš„ï¼Ÿ</font>

## èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ
1. åœ¨ReviewViewControlleré‡ŒåŠ å…¥ä»£ç ï¼š
``` swift
class ReviewViewController: UIViewController {
    // ...
    override func viewDidLoad() {
        super.viewDidLoad()

        // å°†ä¼ å…¥çš„restaurantçš„å›¾ç‰‡è®¾ç½®ä¸ºèƒŒæ™¯å›¾
        backgroundImageView.image = UIImage(named: restaurant.image)
        
        // åˆ›å»ºç‰¹æ•ˆè§†å›¾
        let blurEffect = UIBlurEffect(style: .dark)
        let blurEffectView = UIVisualEffectView(effect: blurEffect)
        blurEffectView.frame = view.bounds
        // å°†ç‰¹æ•ˆè§†å›¾æ·»åŠ åˆ°èƒŒæ™¯è§†å›¾ä¸Š
        backgroundImageView.addSubview(blurEffectView)
    }
}
```
æ¨¡ç³Šæ•ˆæœçš„styleå¯ä»¥é€‰æ‹©.darkã€.lightã€.extraLightæ•ˆæœå¦‚ä¸‹ï¼š

![](images/1705.png)

## å…³è”ä¸€ä¸ªoutleté›†åˆ
æœ¬ç« äº”ä¸ªè¯„ä»·æŒ‰é’®æ˜¯ç±»ä¼¼çš„ï¼Œå› æ­¤å¯ä»¥å®šä¹‰ä¸€ä¸ªoutleté›†åˆã€‚
1. åœ¨ReviewViewControllerä¸­å®šä¹‰å¦‚ä¸‹ï¼š
``` swift
class ReviewViewController: UIViewController {
    @IBOutlet var rateButtons: [UIButton]!
    // ...
}
```
2. å³é”®ReviewViewControllerï¼Œå°†rateButtonsæ‹–åˆ°5ä¸ªæŒ‰é’®ä¸Šå„ä¸€æ¬¡

![](images/1706.png)

æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è®¿é—®äº”ä¸ªæŒ‰é’®äº†ï¼š
``` swift
rateButtons[0] // AwesomeæŒ‰é’®
rateButtons[1] // GoodæŒ‰é’®
rateButtons[2] // OkayæŒ‰é’®
rateButtons[3] // BadæŒ‰é’®
rateButtons[4] // TerribleæŒ‰é’®
```
## åˆ¶å®šå¼¹å‡ºåŠ¨ç”»
1. åœ¨ReviewViewControllerä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š
``` swift
class ReviewViewController: UIViewController {
    // ...
    override func viewDidLoad() {
        // ...
        
        // å®šä¹‰åˆå§‹ä½ç½®ï¼šå³ç§»600åƒç´ 
        let moveRightTransform = CGAffineTransform.init(translationX: 600, y: 0)
        // è®¾ç½®åŠ¨ç”»çš„åˆå§‹çŠ¶æ€ï¼šæ‰€æœ‰è¯„ä»·æŒ‰é’®ä¸å¯è§ï¼Œå¹¶å‘å³å¹³ç§»600ä¸ªç‚¹
        for rateButton in rateButtons{
            rateButton.transform = moveRightTransform
            rateButton.alpha = 0
        }
    }
    
    override func viewWillAppear(_ animated: Bool) {
        // è®¾ç½®åŠ¨ç”»çš„ç»ˆæ€ï¼šæ‰€æœ‰è¯„ä»·æŒ‰é’®å¯è§ï¼ŒåŠ¨ç”»æ—¶é•¿2ç§’é’Ÿï¼Œå¹¶æ¢å¤åˆ°IBä¸­è®¾ç½®çš„åˆå§‹ä½ç½®
        UIView.animate(withDuration: 0.4, delay: 0.1, options: [], animations: {
            self.rateButtons[0].alpha = 1.0
            self.rateButtons[0].transform = .identity
        }, completion: nil)
        UIView.animate(withDuration: 0.4, delay: 0.15, options: [], animations: {
            self.rateButtons[1].alpha = 1.0
            self.rateButtons[1].transform = .identity
        }, completion: nil)
        UIView.animate(withDuration: 0.4, delay: 0.2, options: [], animations: {
            self.rateButtons[2].alpha = 1.0
            self.rateButtons[2].transform = .identity
        }, completion: nil)
        UIView.animate(withDuration: 0.4, delay: 0.25, options: [], animations: {
            self.rateButtons[3].alpha = 1.0
            self.rateButtons[3].transform = .identity
        }, completion: nil)
        UIView.animate(withDuration: 0.4, delay: 0.3, options: [], animations: {
            self.rateButtons[4].alpha = 1.0
            self.rateButtons[4].transform = .identity
        }, completion: nil)
    }
}
```
ç»“æ„ä½“CGAffineTransformå¯ä»¥ç”¨æ¥å®šä¹‰ä½ç§»ã€ç¼©æ”¾ã€æ—‹è½¬è§†å›¾ç­‰å„ç§ç±»å‹çš„ä»¿å°„å˜æ¢ã€‚
ä¸Šä¾‹åœ¨viewDidLoadä¸­å…ˆå°†æ‰€æœ‰æŒ‰é’®å³ç§»600ç‚¹ï¼Œå¾…è¦æ˜¾ç¤ºæ—¶ï¼Œå†è®¾ç½®å›IBä¸­çš„åˆå§‹ä½ç½®ï¼Œè¿™å°±å®Œæˆäº†ä»å³ä¾§é£å…¥çš„åŠ¨ç”»æ•ˆæœã€‚
> å•è¯Affineçš„æ„æ€æ˜¯ä»¿å°„ï¼Œæ˜¯æŒ‡ä¸€ä¸ªå‘é‡ç©ºé—´è¿›è¡Œä¸€æ¬¡çº¿æ€§å˜æ¢ï¼Œå¹¶æ¥ä¸Šä¸€ä¸ªå¹³ç§»ï¼Œå˜æ¢ä¸ºå¦ä¸€ä¸ªå‘é‡ç©ºé—´ï¼Œä¹‹åå†æŠŠæŒ‰é’®çš„transformè®¾ç½®å›.identity

å¤šä¸ªåŠ¨ç”»ä¹‹é—´å¯ä»¥å åŠ ï¼Œæ¯”å¦‚ï¼š
``` swift
let moveRightTransform = CGAffineTransform.init(translationX: 600, y: 0)  // åŠ¨ç”»1
let scaleUpTransform = CGAffineTransform.init(scaleX: 5.0, y: 5.0)        // åŠ¨ç”»2
let moveScaleTransform = scaleUpTransform.concatenating(moveRightTransform) // å åŠ 

// Make the button invisible and move off the screen
for rateButton in rateButtons {
    rateButton.transform = moveScaleTransform
    rateButton.alpha = 0
}
```
è¿˜å¯ä»¥å†åŠ ä¸Šå¼¹ç°§æ•ˆæœï¼š
``` swift
UIView.animate(withDuration: 0.8, delay: 0.1, 
usingSpringWithDamping: 0.2,  // æ§åˆ¶æŒ¯åŠ¨é¢‘ç‡
initialSpringVelocity: 0.3,   // æ§åˆ¶æŒ¯å¹…
options: [], animations: {
    self.rateButtons[0].alpha = 1.0
    self.rateButtons[0].transform = .identity
}, completion: nil)
```

## åœ¨è½¬åœºå›é€€æ—¶ä¼ é€’æ•°æ®
1. ä¿®æ”¹Restaurantç±»å‹ï¼Œæ·»åŠ ç”¨äºå­˜å‚¨è¯„ä»·çš„å˜é‡ï¼š
``` swift
struct Restaurant: Hashable {
    enum Rating: String{    // å®šä¹‰è¯„ä»·çš„æ•°æ®ç±»å‹
        case awesome
        case good
        case okay
        case bad
        case terrible
        
        var image: String{
            switch self {
            case .awesome:
                return "love"
            case .good:
                return "cool"
            case .okay:
                return "happy"
            case .bad:
                return "sad"
            case .terrible:
                return "angry"
            }
        }
    }
    var name: String = ""
    var type: String = ""
    var location: String = ""
    var phone: String = ""
    var description: String = ""
    var image: String = ""
    var isFavorite: Bool = false
    var rating: Rating?		// è¯„ä»·
}
```
> è¿™é‡Œè®°å½•è¯„ä»·çš„å˜é‡æœ¬è´¨ä¸Šå°±æ˜¯å­—ç¬¦ä¸²ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨Stringå‘¢ï¼Ÿå®šä¹‰æšä¸¾ç±»å‹å¯ä»¥è®©ç¼–è¯‘å™¨å¸®åŠ©æ£€æŸ¥æ‰‹è¯¯ã€‚
2. å›åˆ°Main.storyboardï¼Œå¾€RestaurantDetailViewControllerçš„é¡¶éƒ¨è§†å›¾çš„å³ä¸‹è§’æ‹–å…¥ä¸€ä¸ªImageViewï¼Œè¿™æ˜¯ç”¨æ¥æ˜¾ç¤ºè¯„ä»·å›¾æ ‡çš„ï¼Œè®¾ç½®è·ç¦»å³ä¸‹ä¾§çš„è¾¹è·å‡ä¸º20ï¼Œå®½50ï¼Œé«˜52
3. åœ¨RestaurantDetailHeaderViewä¸­å®šä¹‰è¯„ä»·å›¾æ ‡ï¼š
``` swift
class RestaurantDetailHeaderView: UIView {
    @IBOutlet var ratingImageView: UIImageView!   // è¯„ä»·å›¾æ ‡
    // ...
}
```
å›åˆ°Main.storyboardä¸­å³é”®RestaurantHeaderViewï¼Œå°†ratingImageViewæ‹–åˆ°è§†å›¾ä¸­çš„å›¾æ ‡ä¸Šï¼Œå»ºç«‹å…³è”ã€‚
4. åœ¨RestaurantDetailViewControllerä¸­æ·»åŠ å›é€€å‡½æ•°ï¼š
``` swift
extension RestaurantDetailViewController: UITableViewDataSource, UITableViewDelegate {
    // å›é€€å¤„ç†å‡½æ•°
    @IBAction func rateRestaurant(segue: UIStoryboardSegue){        
    }
```
å›åˆ°Main.storyboardä¸­æ‘ä½Ctrlå°†æ¯ä¸ªè¯„ä»·æŒ‰é’®æ‹–åˆ°exitå›¾æ ‡ä¸Šï¼Œå¹¶åœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©rateRestaurantWithSegueï¼Œè¿™ä¼šåœ¨document outlineä¸­åˆ›å»ºä¸€ä¸ªå›é€€è½¬åœºï¼Œåˆ†åˆ«å°†è¿™äº›è½¬åœºidentifierå‘½åä¸ºè¯„ä»·æŒ‰é’®çš„æ–‡æœ¬ä¸²ï¼š

![](images/1707.png)
5. æ›´æ–°å›é€€å‡½æ•°å¦‚ä¸‹ï¼š
``` swift
extension RestaurantDetailViewController: UITableViewDataSource, UITableViewDelegate {
    
    @IBAction func rateRestaurant(segue: UIStoryboardSegue){
        // è·å–å›é€€è½¬åœºçš„id
        guard let identifier = segue.identifier else{
            return
        }
        // æ›´æ–°è¯„ä»·å›¾æ ‡
        if let rating = Restaurant.Rating(rawValue: identifier){
            self.restaurant.rating = rating
            self.headerView.ratingImageView.image = UIImage(named: rating.image)
        }
        dismiss(animated: true, completion: nil)
    }
    // ...
}
```
**æœ€å…³é”®çš„æ­¥éª¤æ˜¯ç¬¬5æ­¥**ï¼šå®ƒå’Œä¸Šé¢çš„ç‚¹`Ã—`é€€å‡ºæ˜¯ä¸€æ ·çš„æœºåˆ¶ï¼Œéƒ½æ˜¯å®šä¹‰äº†é€€å‡ºå‡½æ•°ï¼Œå¹¶åœ¨IBä¸­è®¾ç½®è§¦å‘ï¼Œåªæ˜¯è¿™é‡Œä¼šæ ¹æ®Segue.identifierè·çŸ¥åˆ°è§¦å‘æºï¼Œå¹¶åšç›¸åº”å¤„ç†

# ç¬¬18ç«  é™æ€è¡¨æ ¼è§†å›¾ã€ç›¸æœºå’ŒNSLayoutConstraint
æœ¬ç« å…è®¸ç”¨æˆ·æ·»åŠ æ–°çš„é¤é¦†ï¼š
![](images/1804.png)
æœ¬ç« è¦ç‚¹åŒ…æ‹¬ï¼š
- **ä½¿ç”¨static table viewæ‰¿è½½æ–°å»ºé¤é¦†ä¿¡æ¯**ï¼Œå’Œå‰é¢çš„dynamic table viewä¸åŒçš„æ˜¯ï¼šdynamicä½¿ç”¨å•å…ƒæ ¼åŸå‹è®¾è®¡å•å…ƒæ ¼å½¢å¼ï¼Œå†åŠ¨æ€å¡«å……å†…å®¹ï¼Œè€Œstaticçš„å†…å®¹éƒ½æ˜¯å›ºå®šçš„
- **è®¾ç½®å›è½¦åè¾“å…¥æ¡†çš„ç„¦ç‚¹é¡ºåº** ä½¿ç”¨è¾“å…¥æ¡†çš„tagè®°å½•ç„¦ç‚¹é¡ºåºï¼Œé€šè¿‡`resignFirstResponder`/`becomeFirstResponder`æ§åˆ¶å¤±å»/è·å–ç„¦ç‚¹
- **è‡ªå®šä¹‰åœ†è§’è¾“å…¥æ¡†** é€šè¿‡æ´¾ç”Ÿé‡è½½UITextFieldçš„`textRect(forBounds:)`ã€`placeHolderRect(forBounds:)`ã€`editingRect(forBounds:)`å®šä¹‰è¾“å…¥éƒ¨åˆ†çš„æ˜¾ç¤ºåŒºåŸŸ
- **è‡ªå®šä¹‰å¯¼èˆªæ å­—ä½“** åœ¨viewDidLoadä¸­è·å–å¯¼èˆªæ çš„standardAppearanceï¼Œå¯ä»¥åšä¿®æ”¹å®šåˆ¶
- **ä½¿ç”¨UIImagePickerControlleré€‰æ‹©æœ¬åœ°ç…§ç‰‡ï¼Œå¹¶è·å–è¢«é€‰ä¸­çš„å›¾ç‰‡**
- **ä½¿ç”¨ä»£ç æ§åˆ¶å¸ƒå±€çº¦æŸ**
- **ç‚¹å‡»ä»»æ„åŒºåŸŸæ”¶å›é”®ç›˜**

## æ–°å»ºRestaurantçš„VC
1. ä¸‹è½½[æ–°å»ºå›¾æ ‡](http://www.appcoda.com/resources/swift53/newphotoicon.zip)ï¼Œå¹¶æ‹–åˆ°å·¥ç¨‹çš„assetä¸‹ã€‚æ‰“å¼€Main.storyboardï¼Œæ·»åŠ ä¸€ä¸ªtable view controllerï¼Œé€‰ä¸­å…¶ä¸‹çš„Table Viewï¼Œåœ¨Attribute inspectorä¸­å°†Content optionä»Dynamic Prototypes**æ”¹ä¸ºStatic Cells**ï¼Œåœ¨document outlineä¸­é€‰ä¸­Table View Sectionï¼Œåœ¨Attribute inspectorä¸­å°†Rowsç”±3æ”¹ä¸º6ï¼š

![](images/1801.png)
2. **ç¬¬ä¸€ä¸ªå•å…ƒæ ¼æ˜¾ç¤ºå›¾ç‰‡**ã€‚ä¿®æ”¹ç¬¬ä¸€ä¸ªTable View Cellï¼Œåœ¨size inspectorè®¾ç½®é«˜åº¦=200ï¼ŒSelection option=Noneï¼Œè¿™æ ·è¯¥å•å…ƒæ ¼å°±æ— æ³•è¢«é€‰ä¸­äº†ã€‚æ·»åŠ ä¸€ä¸ªimage view åˆ°è¯¥å•å…ƒæ ¼ï¼Œè®¾ç½®å›¾ç‰‡ä¸ºç¬¬1æ­¥åŠ å…¥çš„newphotoï¼ŒèƒŒæ™¯è‰²=System Gray 6 Colorï¼Œå››ä¸ªè¾¹è·=0ã€‚
3. **ç¬¬äºŒä¸ªTable View Cellæ˜¾ç¤ºåç§°**ï¼Œè®¾ç½®Selection option=Noneã€‚æ‹–å…¥ä¸€ä¸ªlabelï¼Œè®¾ç½®title=NAMEï¼Œfont=Headline styleï¼Œfont color=dark grayã€‚åœ¨å…¶ä¸‹æ–¹å†æ‹–å…¥ä¸€ä¸ªtext fieldï¼Œè®¾ç½®placeholder=Fill in the restaurant nameï¼Œfont type=Bodyã€‚é€‰ä¸­è¿™ä¸¤ä¸ªæ§ä»¶ï¼Œç‚¹å‡»å³ä¸‹è§’Embed - Stack Viewï¼Œå°†ä»–ä»¬åŒ…è£¹åœ¨ä¸€ä¸ªStack Viewé‡Œï¼Œè®¾ç½®è¯¥Stack Viewçš„å››è¾¹è·=0ã€‚å°†Alignment optionç”±Leadingè®¾ç½®ä¸ºFillï¼Œå¹¶ä¿®æ”¹spacing=5ã€‚
4. **ç¬¬ä¸‰ã€å››ã€äº”ä¸ªå•å…ƒæ ¼åŒç¬¬äºŒä¸ª**ï¼Œåªæ˜¯label titleåˆ†åˆ«ä¸ºï¼šTYPEã€ADDRESSå’ŒPHONEã€‚ç¬¬å…­ä¸ªå•å…ƒæ ¼çš„label title=DESCRIPTIONï¼Œè¾“å…¥æ¡†ä½¿ç”¨`Text View`ï¼Œå’Œtext fieldä¸åŒçš„æ˜¯ï¼Œè¯¥è¾“å…¥æ¡†å¯ä»¥è¾“å…¥å¤šè¡Œæ–‡å­—ï¼Œè®¾ç½®initial textï¼šA gread restaurant to try outï¼Œbackground colorï¼šSystem Gray 6 Colorï¼Œfontï¼šBody text styleï¼Œå…¶ä½™è®¾ç½®åŒç¬¬äºŒä¸ªå•å…ƒæ ¼ã€‚
5. **å°†ç¬¬1æ­¥ä¸­æ–°å»ºçš„table view controllerç”¨å¯¼èˆªæ åŒ…è£¹ä½** é€‰ä¸­ç¬¬1æ­¥ä¸­æ–°å»ºçš„table view controllerï¼Œç‚¹å‡»èœå• Editor - Embed in - Navigation Controllerï¼Œç‚¹å‡»Table View Controllerçš„navigation barï¼Œè®¾ç½®å…¶Navigation Item/Itemä¸ºNew Restaurantã€‚é€‰ä¸­Navigation Controller/Navigation Barï¼Œå‹¾é€‰Attributes inspector/Navigation Bar/Perfers Large Titleé€‰é¡¹
6. **åœ¨é¦–é¡µæ·»åŠ è§¦å‘æ–°å»ºçš„æŒ‰é’®** å¾€Food Pin VCçš„navigation baræ·»åŠ ä¸€ä¸ªbar button itemï¼Œè®¾ç½®Titleä¸ºç©ºï¼ŒImageä¸ºplusï¼Œtintä¸ºLabel Colorã€‚æ‘ä½Ctrlå°†+æŒ‰é’®æ‹–åˆ°ä¸Šé¢åˆ›å»ºçš„New Restaurant navigation controllerä¸Šï¼Œé€‰æ‹©present modallyï¼Œå¹¶å°†segue identifierè®¾ç½®ä¸ºaddRestaurantã€‚
7. åœ¨New Restaurant VCçš„navigation barå·¦ä¸Šæ–¹æ·»åŠ ä¸€ä¸ªbar button itemï¼Œè®¾ç½®titleä¸ºç©ºï¼ŒImage ä¸ºxmarkï¼Œtintä¸ºLabel Color

![](images/1802.png)

8. åœ¨RestaurantTableViewControllerä¸­æ·»åŠ è½¬åœºè¿”å›å‡½æ•°ï¼š
``` swift
class RestaurantTableViewController: UITableViewController {
    // ...
  
  @IBAction func unwindToHome(segue: UIStoryboardSegue){  // è½¬åœºè¿”å›å‡½æ•°
    dismiss(animated: true, completion: nil)
  }
}
```
å†å›åˆ°Main.storyboardä¸­ï¼Œæ‘ä½Ctrlå°†å…³é—­æŒ‰é’®æ‹–åˆ°æ‰€åœ¨VCçš„Exitå›¾æ ‡ï¼Œé€‰æ‹©unwindToHomeWithSegue

![](images/1803.png)

## æ„é€ åœ†è§’Text Field
1. æ–°å»ºæ–‡ä»¶ï¼Œé€‰æ‹©æ¨¡æ¿Cocoa Touch Classï¼Œç±»åRoundedTextFieldï¼ŒåŸºç±»UITextFieldï¼Œä»£ç å¦‚ä¸‹ï¼š
``` swift
class RoundedTextField: UITextField {
  // è®¾ç½®ç¼©è¿›å°ºå¯¸
  let padding = UIEdgeInsets(top: 0, left: 15, bottom: 0, right: 15);
  
  // è¿”å›ç”»textçš„çŸ©å½¢
  override func textRect(forBounds bounds: CGRect) -> CGRect{
    return bounds.inset(by: padding)
  }
  
  // è¿”å›placeholderæ–‡æœ¬çš„çŸ©å½¢
  override func placeholderRect(forBounds bounds: CGRect) -> CGRect {
    return bounds.inset(by: padding)
  }
  
  // è¿”å›è¾“å…¥æ–‡æœ¬çš„çŸ©å½¢
  override func editingRect(forBounds bounds: CGRect) -> CGRect {
    return bounds.inset(by: padding)
  }
  
  // æ¯æ¬¡é‡æ–°å¸ƒå±€æ—¶è°ƒç”¨
  override func layoutSubviews() {
    super.layoutSubviews()
    
    self.layer.borderWidth = 1.0  // è¾¹æ¡†å®½åº¦
    self.layer.borderColor = UIColor.systemGray5.cgColor  // è¾¹æ¡†é¢œè‰²
    self.layer.cornerRadius = 10.0   // åœ†è§’å¼§åº¦
    self.layer.masksToBounds = true
  }
}
```
2. å°†ç”¨äºè¾“å…¥æ–°åˆ›å»ºçš„Restaurantçš„Nameã€Typeã€Addressã€Phoneçš„TextFieldçš„Classè®¾ç½®ä¸ºRoundedTextField
## è®¾ç½®ç„¦ç‚¹é¡ºåº
å½“åœ¨nameè¾“å…¥æ¡†ä¸­ç‚¹å‡»å›è½¦é”®ï¼Œæˆ‘ä»¬å¸Œæœ›ç„¦ç‚¹èƒ½æŒªåˆ°ä¸‹ä¸€ä¸ªtypeè¾“å…¥æ¡†ä¸­
1. æ–°å»ºæ–‡ä»¶ï¼Œé€‰æ‹©æ¨¡æ¿ä¸ºCocoa Touch Classï¼Œç±»åä¸ºNewRestaurantControllerï¼ŒåŸºç±»ä¸ºUITableViewControllerï¼Œæ›´æ–°ä»£ç å¦‚ä¸‹ï¼š
``` swift
class NewRestaurantTableViewController: UITableViewController {
  // â‘  ä¾æ¬¡è®¾ç½®ç„¦ç‚¹é¡ºåº
  @IBOutlet var nameTextField: RoundedTextField!{
    didSet{
      nameTextField.tag = 1  // è®¾ç½®ç„¦ç‚¹é¡ºåº
      nameTextField.becomeFirstResponder() // å°†nameè®¾ç½®ä¸ºfirst responder
      nameTextField.delegate = self
    }
  }

  @IBOutlet var typeTextField: RoundedTextField!{
    didSet{
      typeTextField.tag = 2
      typeTextField.delegate = self
    }
  }
  
  @IBOutlet var addressTextField: RoundedTextField!{
    didSet{
      addressTextField.tag = 3
      addressTextField.delegate = self
    }
  }
  
  @IBOutlet var phoneTextField: RoundedTextField!{
    didSet{
      phoneTextField.tag = 4
      phoneTextField.delegate = self
    }
  }
  
  @IBOutlet var descriptionTextView: UITextView!{
    didSet{
      descriptionTextView.tag = 5
      descriptionTextView.layer.cornerRadius = 10.0
      descriptionTextView.layer.masksToBounds = true
    }
  }
  
    override func viewDidLoad() {
        super.viewDidLoad()
    }

    // â‘¡ åˆ é™¤ä¸éœ€è¦çš„ä¸¤ä¸ªå‡½æ•°
	// override func numberOfSections(in tableView: UITableView) -> Int {
	//	return 0
	// }
	//
	// override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
	//	return 0
	// }
}

// æ‰©å±•UITextFieldDelegateåè®®ï¼Œå½“ç‚¹å‡»å›è½¦é”®ï¼Œç§»åŠ¨ç„¦ç‚¹
extension NewRestaurantControllerTableViewController: UITextFieldDelegate{
  // å½“ç‚¹å‡»å›è½¦é”®
  func textFieldShouldReturn(_ textField: UITextField) -> Bool {
    // è·å–ä¸‹ä¸€ä¸ªè¾“å…¥ç„¦ç‚¹
    if let nextTextField = view.viewWithTag(textField.tag + 1) {
      textField.resignFirstResponder()     // é‡Šæ”¾first responder
      nextTextField.becomeFirstResponder() // æˆä¸ºfirst responder
    }
    return true
  }
}
```
## ä½¿ç”¨UIImagePickerControlleræ˜¾ç¤ºå›¾ç‰‡åº“
1. **å¼¹å‡ºæ˜¾ç¤ºç›¸æœº/ç›¸å†Œçš„çª—å£** å‘NewRestaurantControllerä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå½“ç‚¹å‡»é¦–è¡Œå•å…ƒæ ¼ï¼Œåˆ™æç¤ºé€‰æ‹©å›¾ç‰‡
``` swift
override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
    if indexPath.row == 0 {   // ç‚¹å‡»é¦–è¡Œå•å…ƒæ ¼
        // å®šä¹‰æç¤ºçª—ï¼Œé€‰æ‹©ç…§ç‰‡
        let photoSourceRequestController = UIAlertController(title: "", message: "Choose your photo source", preferredStyle: .actionSheet)

        // å®šä¹‰è¡ŒåŠ¨ç‚¹ï¼Œè§¦å‘æ‹ç…§
        let cameraAction = UIAlertAction(title: "Camera", style: .default, handler: { (action) in
            if UIImagePickerController.isSourceTypeAvailable(.camera) {
                let imagePicker = UIImagePickerController()
                imagePicker.allowsEditing = false
                imagePicker.sourceType = .camera
                imagePicker.delegate = self  // æ‹æ‘„å®Œæˆåï¼Œç”±selfæ¥æ”¶
                    
                self.present(imagePicker, animated: true, completion: nil)
            }
        })

        // å®šä¹‰è¡ŒåŠ¨ç‚¹ï¼Œè§¦å‘ç›¸å†Œ
        let photoLibraryAction = UIAlertAction(title: "Photo library", style: .default, handler: { (action) in
            if UIImagePickerController.isSourceTypeAvailable(.photoLibrary) {
                let imagePicker = UIImagePickerController()
                imagePicker.allowsEditing = false
                imagePicker.sourceType = .photoLibrary
                imagePicker.delegate = self  // é€‰ä¸­å›¾ç‰‡åï¼Œç”±selfæ¥æ”¶
                    
                self.present(imagePicker, animated: true, completion: nil)
            }
        })

        // æ·»åŠ è¡ŒåŠ¨ç‚¹
        photoSourceRequestController.addAction(cameraAction)
        photoSourceRequestController.addAction(photoLibraryAction)

        // For iPad
        if let popoverController = photoSourceRequestController.popoverPresentationController {
            if let cell = tableView.cellForRow(at: indexPath) {
                popoverController.sourceView = cell
                 popoverController.sourceRect = cell.bounds
            }
        }

        // å¼¹å‡ºæç¤ºçª—
        present(photoSourceRequestController, animated: true, completion: nil)
    }
}
```
å¼¹å‡ºçš„æç¤ºçª—å¦‚ä¸‹æ‰€ç¤ºï¼š

![](images/1804.png)
2. **ç”³è¯·ç›¸å…³æƒé™** åœ¨iOS10åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå‡ºäºéšç§çš„åŸå› ï¼Œè¦æ±‚å¼€å‘è€…å¿…é¡»æ˜¾å¼å£°æ˜appè®¿é—®ç›¸å†Œæˆ–ç›¸æœºçš„åŸå› ï¼Œéœ€è¦åœ¨Info.plistä¸­æ·»åŠ ä¸¤ä¸ªå…³é”®å­—ï¼šNSPohtoLibraryUsageDescriptionå’ŒNSCameraUsageDescriptionã€‚é€‰ä¸­Info.plist - å³é”®Information Property List - Add Rowï¼Œ
è®¾ç½®keyï¼šPrivacy - Photo Library Usage Descriptionï¼Œ
valueï¼šYou need to grant the app access to your photo library so you can pick your favorite restaurant photo.ï¼›
å†æ·»åŠ ä¸€è¡Œ:
è®¾ç½®keyï¼šPrivacy - Camera Usage Descriptionï¼Œ
valueï¼šYou need to grant the app access to your camera in order to take photos.
ä¸è¿‡æˆ‘åœ¨æ¨¡æ‹Ÿå™¨ä¸‹åˆ é™¤è¿™ä¸¤ä¸ªå…³é”®å­—ï¼Œç¨‹åºä¾ç„¶èƒ½æ­£å¸¸è·‘
## è·å–è¢«é€‰ä¸­çš„å›¾ç‰‡
éœ€è¦è®©NewRestaurantControllerå®ç°UIImagePickerControllerDelegateå’ŒUINavigationControllerDelegateåè®®ã€‚å½“ä»ç›¸å†Œä¸­é€‰ä¸­ä¸€å¼ å›¾ç‰‡ï¼Œåè®®çš„imagePickerController(_:didFinishPickingMediaWithInfo:)ä¼šè¢«è°ƒç”¨ã€‚
1. åœ¨NewRestaurantControllerä¸­å®šä¹‰ImageViewå˜é‡ï¼Œç”¨äºæ˜¾ç¤ºå›¾ç‰‡ï¼š
``` swift
class NewRestaurantController: UITableViewController {
    @IBOutlet var photoImageView: UIImageView! {
        didSet {
            photoImageView.layer.cornerRadius = 10.0
            photoImageView.layer.masksToBounds = true
            
        }
    }
    // ...
}
```
å¹¶å°†è¯¥å˜é‡å…³è”åˆ°æ§ä»¶ï¼š

![](images/1805.png)
2. è·å–è¢«é€‰ä¸­çš„å›¾ç‰‡ï¼Œå¹¶æ›´æ–°åˆ°ImageViewä¸Šï¼š
``` swift
extension NewRestaurantController: UIImagePickerControllerDelegate, UINavigationControllerDelegate{
    func imagePickerController(_ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey : Any]) {

        // è·å–è¢«é€‰ä¸­çš„å›¾ç‰‡
        if let selectedImage = info[UIImagePickerController.InfoKey.originalImage] as? UIImage {
            photoImageView.image = selectedImage
            photoImageView.contentMode = .scaleAspectFill
            photoImageView.clipsToBounds = true
        }

        dismiss(animated: true, completion: nil)
    }
    
}
```
## ä½¿ç”¨ä»£ç çº¦æŸå¸ƒå±€&å…³é—­é”®ç›˜
å‰é¢éƒ½æ˜¯åœ¨Interface Builderä¸­è®¾ç½®å¸ƒå±€çº¦æŸï¼Œä½¿ç”¨ä»£ç ä¹Ÿæœ‰ç­‰ä»·åšæ³•ã€‚æœ¬èŠ‚ä»¥ImageViewä¸ºä¾‹
1. é¦–å…ˆåˆ é™¤åœ¨Interface Builderä¸­çš„è®¾ç½®çš„å››è¾¹è·çº¦æŸã€‚
2. åœ¨NewRestaurantControllerä¸­æ›´æ–°viewDidLoadå‡½æ•°ã€‚
``` swift
class NewRestaurantController: UITableViewController {    
    override func viewDidLoad() {
        super.viewDidLoad()

        // ...
        
        // è·å–çˆ¶çª—å£çš„è¾¹è·
        let margins = photoImageView.superview!.layoutMarginsGuide
        
        // ä»¤å¸ƒå±€çº¦æŸä»£ç ç”Ÿæ•ˆ
        photoImageView.translatesAutoresizingMaskIntoConstraints = false
        
        // å®šä¹‰ImageViewå››è¾¹è·çš„çº¦æŸ
        photoImageView.leadingAnchor.constraint(equalTo: margins.leadingAnchor).isActive = true
        photoImageView.trailingAnchor.constraint(equalTo: margins.trailingAnchor).isActive = true
        photoImageView.topAnchor.constraint(equalTo: margins.topAnchor).isActive = true
        photoImageView.bottomAnchor.constraint(equalTo: margins.bottomAnchor).isActive = true

        // å½“ç”¨æˆ·ç‚¹å‡»ImageViewçš„ä»»ä½•åŒºåŸŸï¼Œéƒ½å…³é—­é”®ç›˜
        let tap = UITapGestureRecognizer(target: view, action: #selector(UIView.endEditing))
        tap.cancelsTouchesInView = false
        view.addGestureRecognizer(tap)
    }
    // ...
}
```
ä¸Šé¢å‡½æ•°æœ«å°¾æ·»åŠ äº†ä¸€ä¸ªæ‰‹åŠ¿â€”â€”å½“ç‚¹å‡»åˆ°ImageViewä»»ä½•åŒºåŸŸï¼Œéƒ½è°ƒç”¨endEditingæ¥å…³é—­é”®ç›˜ã€‚